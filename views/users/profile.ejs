<% layout('layouts/boilerplate') %>

<div class="container my-5">

  <!-- Profile Header -->
  <div class="card shadow-sm rounded-4 border-0 mb-4">
    <div class="card-body d-flex flex-column flex-md-row align-items-center">
      <div class="me-md-4 text-center">
        <i class="fa-solid fa-circle-user fa-6x text-secondary"></i>
      </div>
      <div>
        <h2 class="fw-bold mb-1"><%= user.username %></h2>
        <p class="text-muted mb-2"><%= user.email %></p>
        <p class="small text-muted">
          Joined on <%= user.createdAt ? user.createdAt.toDateString() : "N/A" %>
        </p>
        <a href="/users/edit" class="btn btn-outline-dark btn-sm">
          <i class="fa-solid fa-pen me-1"></i> Edit Profile
        </a>
      </div>
    </div>
  </div>

  <!-- User Blogs -->
  <div class="mb-5">
    <h3 class="fw-bold mb-3">My Blogs</h3>
    <% if (!user.blogs || user.blogs.length === 0) { %>
      <p class="text-muted fst-italic">You haven’t written any blogs yet.</p>
    <% } else { %>
      <div class="row g-3">
        <% user.blogs.forEach(blog => { %>
          <div class="col-12 col-md-6 col-lg-4">
            <div class="card shadow-sm rounded-4 border-0 h-100">
              <img src="<%= blog.image?.url || '/images/default.jpg' %>" alt="<%= blog.title %>" class="card-img-top rounded-top-4">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="/blogs/<%= blog._id %>" class="text-dark text-decoration-none">
                    <%= blog.title %>
                  </a>
                </h5>
                <p class="card-text text-muted"><%= blog.content.substring(0, 100) %>...</p>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

  <!-- User Reviews -->
  <div>
    <h3 class="fw-bold mb-3">My Reviews</h3>
    <% if (!user.reviews || user.reviews.length === 0) { %>
      <p class="text-muted fst-italic">You haven’t written any reviews yet.</p>
    <% } else { %>
      <div class="row g-3">
        <% user.reviews.forEach(review => { %>
          <div class="col-12 col-md-6">
            <div class="card shadow-sm rounded-4 border-0 review-card">
              <div class="card-body">
                <!-- Blog Link -->
                <h6 class="card-subtitle mb-2">
                  On <a href="/blogs/<%= review.blog._id %>" class="fw-bold"><%= review.blog.title %></a>
                </h6>

                <!-- Rating -->
                <p class="starability-result mb-2" data-rating="<%= review.rating %>"></p>

                <!-- Comment -->
                <p class="card-text"><%= review.comment %></p>

                <small class="text-muted">Posted on <%= review.createdAt ? review.createdAt.toDateString() : "N/A" %></small>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

</div>

<style>
  .review-card {
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .review-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  }
</style>